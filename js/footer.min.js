$(document).ready(function () {
    const observer = lozad();
    observer.observe();
  
    $(document).on("click", ".has-sub", function () {
      var $this = $(this);
      if ($this.hasClass("expanded")) {
        $(".has-sub ul").each(function (index, element) {
          var $ul = $(this);
          if ($this.find("ul")[0] !== element || expandAll) {
            setTimeout(function () {
              $ul.attr("style", "");
            }, 300);
          }
        });
      } else {
        setTimeout(function () {
          $this.find("ul").attr("style", "");
        }, 300);
      }
    });
  
    $(".user-info-menu .hidden-sm").click(function () {
      if ($(".sidebar-menu").hasClass("collapsed")) {
        $(".has-sub.expanded > ul").attr("style", "");
      } else {
        $(".has-sub.expanded > ul").show();
      }
    });
  
    $("#main-menu li ul li").click(function () {
      $(this).siblings("li").removeClass("active");
      $(this).addClass("active");
    });
  
    $("a.smooth").click(function (e) {
      e.preventDefault();
      public_vars.$mainMenu.add(public_vars.$sidebarProfile).toggleClass("mobile-is-visible");
      ps_destroy();
      $("html, body").animate(
        {
          scrollTop: $($(this).attr("href")).offset().top - 30,
        },
        {
          duration: 500,
          easing: "swing",
        }
      );
    });
  
    $("a.smooth").click(function (e) {
      $("#main-menu li").each(function () {
        $(this).removeClass("active");
      });
  
      $(this).parent("li").addClass("active");
  
      e.preventDefault();
      href = $(this).attr("href");
      pos = $(href).position().top - 30;
    });
  
    (function () {
      if (
        "" ===
        document.cookie.replace(/(?:(?:^|.*;\s*)night\s*=\s*([^;]*).*$)|^.*$/, "$1")
      ) {
        if (
          new Date().getHours() > 22 ||
          new Date().getHours() < 6
        ) {
          document.body.classList.add("night");
          document.cookie = "night=1;path=/";
        } else {
          document.body.classList.remove("night");
          document.cookie = "night=0;path=/";
        }
      } else {
        var nightModeCookie = document.cookie.replace(
          /(?:(?:^|.*;\s*)night\s*=\s*([^;]*).*$)|^.*$/,
          "$1"
        );
        if (nightModeCookie === "0") {
          document.body.classList.remove("night");
        } else if (nightModeCookie === "1") {
          document.body.classList.add("night");
        }
      }
  
      // 调整布局的逻辑
      function adjustLayout() {
        if ($(window).width() < 576) {
          $(".row .col-sm-3").removeClass("col-sm-3").addClass("col-12");
        } else {
          $(".row .col-12").removeClass("col-12").addClass("col-sm-3");
        }
      }
  
      adjustLayout(); // 页面加载时执行一次适配
      $(window).resize(adjustLayout); // 在窗口大小改变时重新适配
    })();
  });
  